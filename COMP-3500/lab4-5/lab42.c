#include <stdio.h>#include <stdlib.h>#include <sys/mman.h>#include <sys/types.h>#include <sys/stat.h>#include <fcntl.h>#include <unistd.h>int nloop = 240;/**********************************************************\ * Function: increment a counter by some amount one by one * * argument: ptr (address of the counter), increment       * * output  : nothing                                       * **********************************************************/void add_n(int *ptr, int increment){  int i,j;  for (i=0; i < increment; i++){    *ptr = *ptr + 1;    for (j=0; j < 7000000;j++);  }}int main(){  int pid;        /* Process ID                     */  int *countptr;  /* pointer to the counter         */  int fd;     /* file descriptor to the file "containing" my counter */  int zero = 0; /* a dummy variable containing 0 */  system("rm -f counter");  /* create a file which will "contain" my shared variable */  fd = open("counter",O_RDWR | O_CREAT);  write(fd,&zero,sizeof(int));  /* map my file to memory */  countptr = (int *) mmap(NULL, sizeof(int),PROT_READ | PROT_WRITE, MAP_SHARED, fd,0);   if (!countptr) {    printf("Mapping failed\n");    exit(1);  }  *countptr = 0;  close(fd);  setbuf(stdout,NULL);  pid = fork();  if (pid < 0){    printf("Unable to fork a process\n");    exit(1);  }  if (pid == 0) {    /* The child increments the counter by two's */    while (*countptr < nloop){      add_n(countptr,2);      printf("Child process -->> counter= %d\n",*countptr);    }    close(fd);  }  else {    /* The parent increments the counter by twenty's */    while (*countptr < nloop){      add_n(countptr,20);      printf("Parent process -->> counter = %d\n",*countptr);    }    close(fd);  }}